{# wedding_project/templates/base.html #}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Join us for our wedding celebration in Thailand! Find all the details about the schedule, accommodation, and travel information here.">
    <meta name="keywords" content="wedding, thailand, phuket, celebration, rsvp">
    <meta name="author" content="Alan Bushell & Maddie Selby">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.flyingbushells.com/">
    <meta property="og:title" content="Alan & Shannon's Wedding in Thailand">
    <meta property="og:description" content="Join us for our wedding celebration in Thailand! Find all the details about the schedule, accommodation, and travel information here.">
    <meta property="og:image" content="{% static 'core/img/bg-cover-photo.jpg' %}">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.flyingbushells.com/">
    <meta property="twitter:title" content="Alan & Shannon's Wedding in Thailand">
    <meta property="twitter:description" content="Join us for our wedding celebration in Thailand! Find all the details about the schedule, accommodation, and travel information here.">
    <meta property="twitter:image" content="{% static 'core/img/bg-cover-photo.jpg' %}">

    <title>{% block title %}Wedding Website{% endblock %}</title>
    {# Favicons & App Icons #}
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon/favicon-16x16.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon/apple-touch-icon.png' %}">
    <link rel="manifest" href="{% static 'favicon/site.webmanifest' %}">
    <link rel="mask-icon" href="{% static 'favicon/safari-pinned-tab.svg' %}" color="#ff00cc">
    <link rel="shortcut icon" href="{% static 'favicon/favicon.ico' %}">
    <meta name="msapplication-TileColor" content="#ff00cc">
    <meta name="theme-color" content="#ff00cc">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    {# NEW: Google Fonts for Wedding & Tropical Vibe #}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Montserrat:wght@300;404;500;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/1b022f26d4.js" crossorigin="anonymous"></script>
    <!--Adobe fonts-->
    <link rel="stylesheet" href="https://use.typekit.net/afa8lir.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% block extra_css %}{% endblock %}
    {% block head_extra %}{% endblock %}
</head>
<body>
    <nav class="navbar sticky-top navbar-expand-lg navbar-dark">
        <div class="container nav-layout">
            <!-- Left third: Logo -->
            <div class="nav-third left">
                <a class="navbar-brand" href="{% url 'home' %}" aria-label="Home"></a>
            </div>
            <!-- Center third: Heading -->
            <div class="nav-third center">
                <h2 class="m-0 text-center">Please join us...</h2>
            </div>
            <!-- Right third: RSVP + (admin utilities if any) -->
            <div class="nav-third right">
                <a class="nav-link rsvp-img" href="{% url 'rsvp' %}" aria-label="Go to RSVP form">
                    <img src="{% static 'core/img/rsvp.png' %}" alt="RSVP" />
                </a>
                {% if user.is_admin %}
                <ul class="navbar-nav admin-links d-none d-lg-flex align-items-center mb-0">
                    <li class="nav-item"><a class="nav-link" href="{% url 'gallery' %}">G</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'article_list' %}">A</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'wedding_details' %}">D</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'profile' %}">Profile ({{ user.username }})</a></li>
                    <li class="nav-item">
                        <form action="{% url 'logout' %}" method="post" class="mb-0">
                            {% csrf_token %}
                            <button type="submit" class="nav-link btn btn-link p-0" aria-label="Logout">L</button>
                        </form>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Login</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'signup' %}">Sign Up</a></li>
                </ul>
                {% endif %}
                {% if user.is_superuser %}
                    <a class="nav-link d-none d-lg-inline-block" href="{% url 'admin:index' %}">Ad</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        {# Django Messages #}
        {% if messages %}
            <ul class="messages list-unstyled">
                {% for message in messages %}
                    <li class="alert alert-{% if message.tags == 'error' %}danger{% elif message.tags == 'success' %}success{% else %}info{% endif %}" role="alert">
                        {{ message }}
                    </li>
                {% endfor %}
            </ul>
        {% endif %}

        {% block content %}
        {# Content from child templates will go here #}
        {% endblock %}
    </div>

    {# Bootstrap JS (optional, but needed for navbar toggle, etc.) #}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    {% block scripts %}{% endblock %}
        {% block extra_js %}{% endblock %}
        <script>
        (function(){
            const navbar = document.querySelector('nav.navbar');
            if(!navbar) return;
            const getHeadings = () => Array.from(document.querySelectorAll('.section-title h2'));

            const computeThresholds = () => {
                const isMobile = window.matchMedia('(min-width: 280px) and (max-width: 430px)').matches;
                const vh = window.innerHeight || 800;
                return {
                    threshold: isMobile ? Math.round(Math.min(260, Math.max(120, vh * 0.22))) : 200,
                    lowerBound: isMobile ? -10 : -40,
                    topVisible: isMobile ? 60 : 100
                };
            };

            let { threshold, lowerBound, topVisible } = computeThresholds();
            let lastState = null;

            const onScroll = () => {
                // Recompute on each scroll to react to orientation/viewport changes
                ({ threshold, lowerBound, topVisible } = computeThresholds());
                const headings = getHeadings();
                if (window.scrollY <= topVisible) {
                    if (lastState !== 'show') {
                        navbar.classList.remove('hidden');
                        lastState = 'show';
                    }
                    return;
                }
                const show = headings.some(h => {
                    const rect = h.getBoundingClientRect();
                    return rect.top >= lowerBound && rect.top <= threshold;
                });
                const desired = show ? 'show' : 'hide';
                if (desired !== lastState) {
                    if (show) {
                        navbar.classList.remove('hidden');
                    } else {
                        navbar.classList.add('hidden');
                    }
                    lastState = desired;
                }
            };
            onScroll();
            window.addEventListener('scroll', onScroll, { passive: true });
            window.addEventListener('resize', onScroll);
        })();
        </script>
</body>
</html>